name: test
on: workflow_dispatch
env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
jobs:
  test:
    name: test
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./b
    steps:
      - name: checkout
        uses: actions/checkout@v3
#      # 下载LSPatch
#      - name: Download LSPatch
#        run: gh release download --repo LSPosed/LSPatch --pattern lspatch.jar
#
#      # 下载待修补的应用
#      - name: Download novelapp
#        run: gh release download -O app.apk --repo AoEiuV020/HookFanqie --pattern 'Fanqie-5.8.5.18.apk'
#
#      # 使用GitHub CLI下载模块最新Release版本
#      - name: 下载模块
#        run: |
#          gh release download -O hook.apk --repo AoEiuV020/HookFanqie --pattern 'HookFanqie-5.8.5.18-hook.apk'

      # 修补
      - name: patch
        run: |
          java -jar lspatch.jar app.apk -m hook.apk

#      # 再次发布Release
#      - name: Release
#        uses: softprops/action-gh-release@v1
#        with:
#          files: app-360-lspatched.apk
#          tag_name: Release
#          name: patchRelease
#          append_body: true
      # 输出文件
      - name: Upload mappings
        uses: actions/upload-artifact@v3
        with:
          name: app-360-lspatched
          path: |
            app-360-lspatched.apk